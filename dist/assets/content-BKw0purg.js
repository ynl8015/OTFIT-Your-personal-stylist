let g=!1,u=null;chrome.runtime.onMessage.addListener((t,e,n)=>{t.action==="toggleSelect"?(g=!g,console.log(`🟢 상품 선택 모드: ${g?"활성화":"비활성화"}`),g?(L(),U()):(b(),k())):t.action==="selectionComplete"&&(g=!1,b(),k(),console.log("🛑 상품 선택 완료로 모드 종료"))});window.onload=function(){const t=document.querySelector(".product-detail");if(!t)return;const e=document.createElement("button");e.innerText="👗 가상 착용",e.style.cssText="position: absolute; top: 10px; right: 10px; background: #ff4081; color: white; padding: 8px; border-radius: 5px; cursor: pointer;",t.appendChild(e),e.addEventListener("click",()=>{var s,c,l;const n=((s=document.querySelector(".product-title"))==null?void 0:s.innerText)||"Unknown",o=((c=document.querySelector(".product-image img"))==null?void 0:c.src)||"",r=((l=document.querySelector(".product-price"))==null?void 0:l.innerText)||"Unknown",i=x(n);o?chrome.runtime.sendMessage({action:"tryOn",product:{name:n,image:o,price:r,category:i}}):alert("상품 이미지를 찾을 수 없습니다.")})};function L(){u=document.createElement("div"),u.style.position="fixed",u.style.top="0",u.style.left="0",u.style.width="100%",u.style.height="100%",u.style.backgroundColor="rgba(0, 0, 0, 0.3)",u.style.zIndex="10000",u.style.pointerEvents="none",document.body.appendChild(u)}function b(){u&&(u.remove(),u=null)}function U(){console.log("🖱 상품 클릭 이벤트 추가됨!"),document.addEventListener("click",v,!0),document.addEventListener("mouseover",C,!0),document.addEventListener("mouseout",q,!0)}function k(){console.log("🛑 상품 클릭 이벤트 제거됨!"),document.removeEventListener("click",v,!0),document.removeEventListener("mouseover",C,!0),document.removeEventListener("mouseout",q,!0)}function C(t){if(!g)return;const e=S(t.target);e&&(e.style.outline="2px solid #ff5500",t.preventDefault(),t.stopPropagation())}function q(t){if(!g)return;const e=S(t.target);e&&(e.style.outline="")}function S(t){let e=t,n=0;const o=10;for(;e&&e!==document.body&&n<o;){if(n++,e.classList&&e.classList.contains("god-item")||e.querySelector&&e.querySelector(".caption")&&e.querySelector("img")||e.classList&&(e.classList.contains("cunit_t232")||e.classList.contains("cunit_t")||e.classList.contains("item")))return e;const r=e.querySelector&&e.querySelector("img"),i=e.textContent&&(e.textContent.includes("원")||e.textContent.match(/\d{3,6}원/));if(r&&i&&e.children&&e.children.length>1)return e;e=e.parentElement}return null}function v(t){if(!g)return;console.log("🖱 상품 클릭 감지됨!",t.target);const e=S(t.target);if(e){const n=T(e);chrome.runtime.sendMessage({action:"tryOn",product:n}),P(e,"✓ 상품이 선택되었습니다"),t.preventDefault(),t.stopPropagation()}}function A(t){var c,l,d,m,f,y;const e=t.querySelector("img");let n=e&&(e.src||e.getAttribute("data-src"))||"",o=((l=(c=t.querySelector(".name, .title, .prd_name"))==null?void 0:c.textContent)==null?void 0:l.trim())||"Unknown";if(o==="Unknown"){const a=document.querySelector(".gods-name#goodDtlTitle");a&&(o=a.textContent.trim())}let r=((m=(d=t.querySelector(".brand"))==null?void 0:d.textContent)==null?void 0:m.trim())||"Unknown";if(r==="Unknown"){const a=document.querySelectorAll("#brandLogo");if(a.length>0){const p=a[0];p.textContent?r=p.textContent.trim():p.getAttribute("alt")&&(r=p.getAttribute("alt").trim())}}let i="0";const s=t.querySelector(".price, .prc, .amount");if(s){const a=s.textContent,p=a.match(/판매가\s*([0-9,]+)/);if(p)i=p[1]+"원";else{const h=a.match(/([0-9,]+)원/);h&&(i=h[1]+"원")}}if(i==="0"||i==="0원"){const a=document.querySelector(".gods-price, .price");if(a){const h=a.textContent.match(/판매가\s*([0-9,]+)/);if(h){i=h[1]+"원";const w=document.querySelector(".preview-img .img-item.active img");w&&(n=w.src||w.getAttribute("data-src")||""),r=((y=(f=document.querySelector("h2.brand-name a"))==null?void 0:f.textContent)==null?void 0:y.trim())||"Unknown"}}}if(o==="Unknown"){const a=document.querySelector(".gods-name#goodDtlTitle");a&&(o=a.textContent.trim())}return{name:o,image:n,price:i,category:x(o),brand:r}}function E(t){var c,l;const e=t.querySelector("img");let n=e&&(e.src||e.getAttribute("data-src"))||"",o=((l=(c=t.querySelector(".text-etc_11px_semibold.line-clamp-1"))==null?void 0:c.textContent)==null?void 0:l.trim())||"Unknown",r=(e==null?void 0:e.getAttribute("alt"))||"Unknown";if(o!=="Unknown"&&r.startsWith(o))r=r.slice(o.length).trim();else if(o==="Unknown"){const d=r.match(/^([\u3131-\u314E\u314F-\u3163\uAC00-\uD7A3\s]+\([A-Z\s]+\))/);d&&(o=d[1],r=r.replace(o,"").trim())}let i="0";const s=t.querySelector("a[data-price]");return s&&(i=s.getAttribute("data-price")+"원"),{name:r,image:n,price:i,category:x(r),brand:o}}function I(t){var c,l,d,m;const e=t.querySelector("img");let n=e&&(e.src||e.getAttribute("data-src"))||"",o=((l=(c=document.querySelector("#pdp_product_name"))==null?void 0:c.textContent)==null?void 0:l.trim())||"Unknown",r=((m=(d=document.querySelector(".css-1dncbyk.eezztd84"))==null?void 0:d.textContent)==null?void 0:m.trim())||"Unknown",i="0";const s=document.querySelector("#pdp_product_price");return s&&(i=s.textContent.trim()),{name:o,image:n,price:i,category:x(o),brand:r}}function _(t){var s,c,l,d,m,f,y;const e=document.querySelector("picture");let n=((s=e==null?void 0:e.querySelector("img"))==null?void 0:s.src)||"",o=((l=(c=document.querySelector(".pdp_shop_info_row .css-gwr30y.e18f5kdz1"))==null?void 0:c.textContent)==null?void 0:l.trim())||"Unknown",r=((m=(d=document.querySelector(".pdp__title .css-1n8byw.e14n6e5u1"))==null?void 0:d.textContent)==null?void 0:m.trim())||"Unknown",i=((y=(f=document.querySelector(".css-no59fe.e1ovj4ty1"))==null?void 0:f.textContent)==null?void 0:y.trim())||"0";return{name:r,image:n,price:i,category:x(r),brand:o}}function T(t){const e=window.location.hostname;let n,o;return e.includes("ssfshop")?(n="SSF",o=A(t)):e.includes("musinsa")?(n="MUSINSA",o=E(t)):e.includes("29cm")?(n="29CM",o=I(t)):e.includes("zigzag")&&(n="ZIGZAG",o=_()),{...o,mall:n,url:window.location.href,maskOffset:o.category==="Lower"?100:0}}function x(t){const e=["pants","jeans","skirt","shorts","leggings","slacks","팬츠","바지","진","청바지","스커트","치마","레깅스","슬랙스","숏팬츠","반바지","쇼츠","와이드팬츠","조거팬츠","카고팬츠","데님"],n=["dress","gown","one-piece","onepiece","드레스","원피스","가운","롱원피스","미니원피스","니트원피스"],o=["shirt","blouse","top","jacket","coat","cardigan","sweater","hoodie","sweatshirt","t-shirt","tee","셔츠","블라우스","탑","자켓","코트","가디건","스웨터","후드","맨투맨","티셔츠","니트","점퍼","패딩","집업","베스트","조끼","크롭","크롭티"],r=["shoes","sneakers","boots","sandals","loafers","heels","slippers","신발","운동화","스니커즈","부츠","샌들","로퍼","힐","슬리퍼","플랫슈즈","구두"],i=["bag","purse","wallet","belt","hat","cap","scarf","necklace","earrings","bracelet","watch","sunglasses","glasses","ring","jewelry","가방","지갑","벨트","모자","스카프","목걸이","귀걸이","팔찌","시계","선글라스","안경","반지","쥬얼리","악세서리","액세서리"],s=t.toLowerCase();return r.some(c=>s.includes(c))?"Shoes":i.some(c=>s.includes(c))?"Accessory":n.some(c=>s.includes(c))?"Dress":e.some(c=>s.includes(c))?"Lower":o.some(c=>s.includes(c))?"Upper":"Unknown"}function P(t,e){const n=document.createElement("div");n.textContent=e,n.style.position="fixed",n.style.top="20px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.backgroundColor="rgba(0, 0, 0, 0.6)",n.style.color="white",n.style.padding="10px 20px",n.style.borderRadius="5px",n.style.zIndex="100000",document.body.appendChild(n),t.style.outline="2px solid green",setTimeout(()=>{n.remove(),t.style.outline=""},2e3)}console.log("✅ 상품 선택 기능 추가 완료!");
